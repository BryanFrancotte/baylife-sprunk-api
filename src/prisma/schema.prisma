generator client {
  provider   = "prisma-client"
  output     = "../generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String    @id @default(cuid()) @db.VarChar(255)
  discordId        String    @unique @db.VarChar(255)
  name             String?   @db.VarChar(255)
  avatar           String?   @db.VarChar(255)
  tokenCipher      String?   @db.VarChar(255)
  tokenNonce       String?   @db.VarChar(255)
  refreshExpiresAt DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  discordName      String    @db.VarChar(255)

  createdDispenser Dispenser[] @relation("AddedDispenser")
  updatedDispenser Dispenser[] @relation("updatedDispenser")
}

model Dispenser {
  id String @id @default(cuid()) @db.VarChar(255)
  ownerId String @db.VarChar(255)
  location String? @db.VarChar(255)
  locationImgUrl String? @db.VarChar(255)
  sharePercentage Int @default(0)
  collectedAmount Int @default(0)
  lastPeriondCollectedAmount Int @default(0)
  totalMoneyGenerated Int @default(0)
  periodStart DateTime?
  periodEnd DateTime?
  createdById String @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedById String? @db.VarChar(255)
  updatedAt DateTime @updatedAt


  owner Client @relation(fields: [ownerId], references: [id])
  createdBy User @relation("AddedDispenser", fields: [createdById], references: [id])
  updatedBy User? @relation("updatedDispenser", fields: [updatedById], references: [id])
}

model Client {
  id String @id @default(cuid()) @db.VarChar(255)
  name String @db.VarChar(255)
  phoneNumber String @unique @db.VarChar(255)
  createdBy String @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedBy String? @db.VarChar(255)
  updatedAt DateTime @updatedAt

  dispensers Dispenser[]
}
